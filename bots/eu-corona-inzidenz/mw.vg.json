{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "description": "A choropleth map depicting Coronavirus prevalence in Europe. 2020.",
  "width": 350,
  "height": 440,
  "padding": {"top": 30},
  "autosize": "none",
  "background": "#fff",
  "data": [
    {
      "name": "counties",
      "url": "https://gist.githubusercontent.com/jonasoesch/9f4caf92da65c77a38e08db3b2621c01/raw/2f664024edeab542bf2d88cb5a6221411d5221d6/borders.json",
      "format": {"type": "topojson", "feature": "regions"}
    },
    {
      "name": "legende",
      "values": [
        {"from": 0, "to": 76.88, "color": "#edece1", 
                  "label": {"name": "0", "position": 0, "align": "left"}},
        {"from": 76.88, "to": 160.21, "color": "#e2d7bb"},
        {"from": 160.21, "to": 257.2, "color": "#ddc197"},
        {"from": 257.2, "to": 394.02, "color": "#daa878"},
        {"from": 394.02, "to": 600.01, "color": "#da8d5f"},
        {"from": 600.01, "to": 960.86, "color": "#d96f4e"},
        {"from": 960.86, "to": 1660.73, "color": "#d64b47", 
                  "label": {"name": "1660.73", "position": 1660.73, "align": "right"}}
      ]
    },
    {
      "name": "legendeLabels",
      "source": "legende",
      "transform": [
        {"type": "filter", "expr": "datum.label != null"}
      ]
    },
    {
      "name": "laender",
      "url": "https://gist.githubusercontent.com/jonasoesch/b3413e6c3d238765f7c97c4ad9578b14/raw/bea7583f10f64fe6e8af0ad99592db87e29c00ec/eu-laender.topo.json",
      "format": {"type": "topojson", "feature": "eu-laender"}
    }
  ],

  "projections": [
    {
      "name": "projection",
      "type": "robinson",
      "scale": 600,
      "center": [41, 50]
    }
  ],

  "scales": [
    {
      "name": "color",
      "type": "threshold",
      "domain": [0, 76.88, 160.21, 257.2, 394.02, 600.01, 960.86, 1660.73],
      "range": ["#edece1", "#e2d7bb", "#ddc197", "#daa878", "#da8d5f", "#d96f4e", "#d64b47"]
    },
    {
      "name": "legende",
      "type": "linear",
      "domain": [0, 1660.73],
      "range": [10, 340]
    }
  ],

  "marks": [
    {
      "type": "shape",
      "from": {"data": "counties"},
      "encode": {
        "enter": { 
          "fill": {"scale": "color", "field": "properties.Incidence7day"},
          "stroke": {"value": "#fff"},
          "strokeWidth": {"value": 0.2}
          }
      },
      "transform": [
        { "type": "geoshape", "projection": "projection" }
      ]
    },
    {
      "type": "shape",
      "from": {"data": "laender"},
      "encode": {
        "enter": { 
          "stroke": {"value": "#fff"},
          "strokeWidth": {"value": 0.6}
          }
      },
      "transform": [
        { "type": "geoshape", "projection": "projection" }
      ]
    },
    {
      "type": "rect",
      "encode": {
        "enter": {
          "width": {"value": 350},
          "height": {"value": 50},
          "x": {"value": 0},
          "y": {"value": -30},
          "fill": {"value": "#fff"}
        }
      }
    },
    {
      "type": "rect",
      "from": {"data": "legende"},
      "encode": {
        "enter": {
          "x": {"field": "from", "scale": "legende"},
          "x2": {"field": "to", "scale": "legende"},
          "height": {"value": 10},
          "fill": {"field": "color"}
        }
      }
    },
    {
      "type": "rule",
      "from": {"data": "legendeLabels"},
      "encode": {
        "enter": {
          "x": {"field": "label.position", "scale": "legende"},
          "x2": {"field": "label.position", "scale": "legende"},
          "y": {"value": 10},
          "y2": {"value": -10},
          "stroke": {"value": "#b6b6be"}
        }
      }
    },
    {
      "type": "text",
      "from": {"data": "legendeLabels"},
      "encode": {
        "enter": {
          "x": {"field": "label.position", "scale": "legende", "offset": {"signal": "if(datum.label.align == 'left', -2, 2)"}},
          "y": {"value": -15},
          "text": {"signal": "round(datum.label.name)"},
          "align": {"field": "label.align"}
        }
      }
    }
  ],
  "config": {
    "axis": {
      "labelFont": "GT America",
      "labelFontSize": 12,
      "titleFont": "GT America",
      "titleFontSize": 14,
      "titleFontWeight": 400,
      "gridColor": "#d4d6dd",
      "labelColor": "#6e6e7e",
      "ticks": false,
      "domain": false,
      "labelPadding": 5
    },
    "text": {
          "fontSize": 14,
          "fill": "#05032d"
      },
  "locale": {
    "number": {
      "decimal": ",",
      "thousands": " ",
      "grouping": [3],
      "currency": ["", " CHF"]
    },
    "time": {
      "dateTime": "%A, der %e. %B %Y, %X",
      "date": "%d. %m. %Y",
      "time": "%H:%M:%S",
      "periods": ["AM", "PM"],
      "days": ["Sonntag", "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag"],
      "shortDays": ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"],
      "months": ["Januar", "Februar", "März", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember"],
      "shortMonths": [ "Jan", "Feb", "Mär", "Apr", "Mai", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dez"]
    }
    }
  }
}

